!function(a,b,c){"use strict";function d(){try{return localStorage.setItem("test",!0),localStorage.removeItem("test"),sessionStorage.setItem("test",!0),sessionStorage.removeItem("test"),!0}catch(a){return!1}}function e(){var a=localStorage.getItem("month"),b=localStorage.getItem("visitCount");if(!sessionStorage.getItem("inSession")){if(b&&a)if(+a===+i){var c=+localStorage.getItem("visitCount");9===c&&(localStorage.getItem("donated")||setTimeout(f.show,1e3)),localStorage.setItem("visitCount",c+1)}else localStorage.setItem("month",i),localStorage.setItem("visitCount",0),localStorage.getItem("donated")&&localStorage.removeItem("donated");else localStorage.setItem("visitCount",0),localStorage.setItem("month",i);sessionStorage.setItem("inSession",!0)}}b.setPublishableKey(FormProcessAJAX.pkey);var f=function(){function a(){p.on("click",l),m.on("click",l),c(".nrd-form").on("click",function(a){a.stopPropagation()}),n.on("submit",e),n.on("keydown","input.error",d)}function d(){var a=c(this);a.removeClass("error"),n.find("input.error").length<1&&(o.removeClass("show").html(""),n.find('input[type="submit"]').prop("disabled",!1))}function e(a){var c=n.find('input[name="email"]').val(),d=n.find('input[name="amount"]').val(),e=n.find('input[name="cvc"]').val(),h=n.find('input[name="card-number"]').val(),i=n.find('input[name="exp-year"]').val(),j=n.find('input[name="exp-month"]').val(),k=[];if((!d||!r.test(d)||parseInt(d)<5||isNaN(d))&&k.push({message:"Please enter a valid donation amount. $5 minimum.",el:n.find('input[name="amount"]')}),c&&q.test(c)||k.push({message:"Please enter a valid email address.",el:n.find('input[name="email"]')}),h&&b.card.validateCardNumber(h)||k.push({message:"Please enter a valid card number.",el:n.find('input[name="card-number"]')}),i&&j&&b.card.validateExpiry(j,i)||k.push({message:"Provided expiration date is invalid or missing.",el:n.find('input[name^="exp-"]')}),e&&r.test(e)||k.push({message:"Security code for your card is missing.",el:n.find('input[name="cvc"]')}),k.length>0){var l=0,m=k.length;for(l;m>l;l++)f(k[l],l==m-1)}else g();a.preventDefault()}function f(a,b){var c=b||!1;a.el&&a.el.addClass("error"),o.append("<span>"+a.message+"</span>"),c&&(o.addClass("show"),n.find('input[type="submit"]').prop("disabled",!0))}function g(){b.card.createToken(n,h),n.find('input[type="submit"]').prop("disabled",!0).val("processing form")}function h(a,b){if(b.error){var d={message:b.error.message,el:n.find('input[data-stripe="'+b.error.param+'"]')};f(d),n.find('input[type="submit"]').prop("disabled",!1).val("submit")}else n.append(c('<input type="hidden" name="stripeToken" />').val(b.id)),i()}function i(){var a={};a.url=FormProcessAJAX.url,a.type="POST",a.data={action:"submit_form",token:n.find('input[name="stripeToken"]').val(),amount:n.find('input[name="amount"]').val(),name:n.find('input[name="name"]').val(),email:n.find('input[name="email"]').val(),subscribe:n.find('input[name="subscribe"]').is(":checked")},a.success=j,a.error=function(){f({message:"Oops, something went wrong. Please try submitting the form again.",el:!1},!0)},c.ajax(a)}function j(a,b){"success"===b?(localStorage.setItem("donated",!0),m.addClass("thank-you")):f({message:"Oops, something went wrong. Please try submitting the form again.",el:!1},!0),n.find('input[type="submit"]').prop("disabled",!1).val("submit")}function k(){m.show(),setTimeout(function(){m.addClass("show")},0)}function l(){m.hide().removeClass("show thank-you"),n[0].reset(),n.find('input[type="submit"]').prop("disabled",!1).val("submit"),n.find(".error").removeClass("error"),o.removeClass("show").html("")}var m=c("#nrd-form-wrapper"),n=m.find("form"),o=m.find(".errors"),p=m.find(".close-form"),q=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/,r=/\S/;return{init:a,show:k,hide:l}}(),g=c(".nr-donate-button"),h=d(),i=(new Date).getMonth()+1;g.length>0&&(f.init(),g.on("click",f.show),h&&e())}(window,Stripe,jQuery);